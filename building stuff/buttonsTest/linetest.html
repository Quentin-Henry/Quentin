<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>navigation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.15.0/js/jsplumb.min.js"></script>
    <link rel="stylesheet" href="linetest.css" />
  </head>
  <body>
    <div class="window" id="window1">Window 1 (Icon)</div>

    <div class="window" id="window2" style="display: none">
      <div id="headerCont">
        <div id="headerText">
          <h1>Window</h1>
        </div>
      </div>
      <div class="buttonParent">
        <div class="two-buttons-container">
          <div class="button-container" id="randomizeCheck">
            <div class="innerWindowCont">
              <h3>Randomizer</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle7" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow5Btn">
            <div class="innerWindowCont">
              <h3>Openness</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle1" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow3Btn">
            <div class="innerWindowCont">
              <h3>AirCon</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle3" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow4Btn">
            <div class="innerWindowCont">
              <h3>Blinds</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle4" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow6Btn">
            <div class="innerWindowCont">
              <h3>Items</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle2" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="window" id="window3" style="display: none">
      <div id="headerCont">
        <div><h4>Window</h4></div>
        <div id="headerText"><h1>AirCon</h1></div>
      </div>

      <div class="buttonParent">
        <div class="two-buttons-container">
          <div class="button-container" id="randomizeCheck">
            <div class="innerWindowCont">
              <h3>Activate</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle7" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow5Btn">
            <div class="innerWindowCont">
              <h3>Rotation</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle1" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow3Btn">
            <div class="innerWindowCont">
              <h3>Supports</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle3" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <div class="button-container" id="createWindow4Btn">
            <div class="innerWindowCont">
              <h3>Location</h3>
              <div class="toggle-container">
                <label class="toggle-switch">
                  <input type="checkbox" id="toggle4" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="window" id="window4" style="display: none">
      <div class="buttonParent">
        <div id="headerCont">
          <div><h4>Window</h4></div>
          <div id="headerText"><h1>Blinds</h1></div>
        </div>
        <div class="bigtextCont"><h6>Type:A</h6></div>
      </div>
    </div>

    <div class="window" id="window5" style="display: none">
      <div class="buttonParent">
        <div id="opt">
          <div id="rangeOpt">
            <div id="rangeCont">
              <input id="myRange" type="range" min="10" max="99" />
            </div>
          </div>
          <div class="windownContentCont">
            <div id="headerCont">
              <div><h4>Window</h4></div>
              <div id="headerText"><h1>Openness</h1></div>
            </div>
            <div id="rangeValueCont"><h6 id="rangeValueContText">97%</h6></div>
          </div>
        </div>
      </div>
    </div>

    <div class="window" id="window6" style="display: none">
      <div>
        <div id="headerCont">
          <div><h4>Window</h4></div>
          <div id="headerText"><h1>Items</h1></div>
        </div>
        <div>
          <div id="progressBarCont">
            <div>
              <p><span id="gridProgressText">0</span> of 4</p>
            </div>
            <div id="progressBar"><div id="progressSilder"></div></div>
          </div>
          <div>
            <div class="grid-container">
              <div class="grid-item" id="box-1"></div>
              <div class="grid-item" id="box-2"></div>
              <div class="grid-item" id="box-3"></div>
              <div class="grid-item" id="box-4"></div>
              <div class="grid-item" id="box-5"></div>
              <div class="grid-item" id="box-6"></div>
              <div class="grid-item" id="box-7"></div>
              <div class="grid-item" id="box-8"></div>
              <div class="grid-item" id="box-9"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="window" id="window7" style="display: none">
      <div class="buttonParent">
        <div id="headerCont">
          <div><h4>Window</h4></div>
          <div id="headerText"><h1>Randomizer</h1></div>
        </div>
        <div id="circleCont">
          <svg
            id="svgCanvas"
            xmlns="http://www.w3.org/2000/svg"
            class="dacircles"
            viewBox="0 0 200 200"
          >
            <circle cx="100" cy="100" r="90" class="outer-circle" />
            <circle cx="100" cy="100" r="60" class="guideline-circle" />
            <circle cx="40" cy="100" r="12" class="inner-circle" />
          </svg>
        </div>
      </div>
    </div>
    <script>
      jsPlumb.ready(function () {
        var instance = jsPlumb.getInstance();
        var connection1,
          connection2,
          connection3,
          connection4,
          connection5,
          connection6,
          connection7;

        var window3Opened = false;
        var window4Opened = false;
        var window5Opened = false;
        var window6Opened = false;
        var window7Opened = false;

        var currentZIndex = 10; // Starting Z-index for other windows

        var slider = document.getElementById("myRange");
        var output = document.getElementById("rangeValueContText");
        output.innerHTML = slider.value + "%";
        slider.oninput = function () {
          output.innerHTML = this.value + "%";
        };

        // Connect Window 1 and Window 2 (Initially invisible)
        connection1 = instance.connect({
          source: "window1",
          target: "window2",
          connector: ["Bezier", { curviness: 20 }],
          anchors: ["RightMiddle", "LeftMiddle"],
          endpoint: "Dot",
          paintStyle: { stroke: "Grey", strokeWidth: 2 },
          endpointStyle: { fill: "Grey", radius: 2 },
        });

        connection1.setVisible(false);

        // Initialize vertical offset for new windows
        var verticalOffset = 0;

        function enableDraggable(windowId) {
          instance.draggable(windowId, { grid: [1, 1] });
        }

        // Function to disable button after window is created
        function disableButton(buttonId) {
          $(buttonId).prop("disabled", true);
        }

        // Function to enable button after window is closed
        function enableButton(buttonId) {
          $(buttonId).prop("disabled", false);
        }

        // Make window clickable and bring it to the front
        function bringToFront(windowId) {
          currentZIndex++;
          $(windowId).css("z-index", currentZIndex);
        }

        $("#window1").click(function () {
          $("#window2").show();
          connection1.setVisible(true);
          $("#window2").css("z-index", currentZIndex);
          enableDraggable("window2");
          enableButton("#createWindow3Btn"); // Enable button when window is shown
          instance.repaintEverything();
          instance.repaint("window2");

          // Keep window1 at the lowest z-index (e.g., 1)
          $("#window1").css("z-index", 1);
        });

        $("#closeWindowBtn").click(function () {
          $("#window2").hide();
          connection1.setVisible(false);
          $("#window3, #window4, #window5, #window6, #window7").hide();
          if (connection2) connection2.setVisible(false);
          if (connection3) connection3.setVisible(false);
          if (connection4) connection4.setVisible(false);
          if (connection5) connection5.setVisible(false);
          if (connection6) connection6.setVisible(false);
          if (connection7) connection7.setVisible(false);
          $("#window2, #window3, #window4, #window5, #window6, #window7").css(
            "z-index",
            15
          );
          enableButton("#createWindow3Btn");
          instance.repaintEverything();
          verticalOffset = 0;

          // Ensure window1 is always at the lowest z-index when any window is closed
          $("#window1").css("z-index", 1);
        });

        // Toggle functionality for Window 3 (Air Conditioner)
        $("#toggle3").change(function () {
          if ($(this).prop("checked")) {
            if ($("#window3").is(":visible")) return; // Prevent opening if already visible

            var window2Position = $("#window2").offset();
            var window3Left =
              window2Position.left + $("#window2").outerWidth() + 20;
            var window3Top =
              window2Position.top + (window3Opened ? 0 : verticalOffset);
            $("#window3").css({
              left: window3Left,
              top: window3Top,
              display: "block",
            });
            enableDraggable("window3");

            connection2 = instance.connect({
              source: "window2",
              target: "window3",
              connector: ["Bezier", { curviness: 20 }],
              anchors: [
                [0.9, 0.5],
                [0.1, 0.5],
              ],
              endpoint: "Dot",
              paintStyle: { stroke: "Grey", strokeWidth: 2 },
              endpointStyle: { fill: "Grey", radius: 2 },
            });

            connection2.setVisible(true);
            $("#window3").css("z-index", currentZIndex);
            instance.repaintEverything();
            disableButton("#createWindow3Btn");

            verticalOffset += 100;
            window3Opened = true;
            currentZIndex++; // Increase Z-index for next window
          } else {
            $("#window3").hide();
            if (connection2) connection2.setVisible(false);
            $("#window3").css("z-index", 5);
            instance.repaintEverything();
            enableButton("#createWindow3Btn");

            verticalOffset -= 100;
            window3Opened = false;
          }
        });

        // Toggle functionality for Window 4 (Blinds)
        $("#toggle4").change(function () {
          if ($(this).prop("checked")) {
            if ($("#window4").is(":visible")) return; // Prevent opening if already visible

            var window2Position = $("#window2").offset();
            var window4Left =
              window2Position.left + $("#window2").outerWidth() + 20;
            var window4Top =
              window2Position.top + (window4Opened ? 0 : verticalOffset);
            $("#window4").css({
              left: window4Left,
              top: window4Top,
              display: "block",
            });
            enableDraggable("window4");

            connection3 = instance.connect({
              source: "window2",
              target: "window4",
              connector: ["Bezier", { curviness: 20 }],
              anchors: [
                [0.9, 0.5],
                [0.1, 0.5],
              ],
              endpoint: "Dot",
              paintStyle: { stroke: "Grey", strokeWidth: 2 },
              endpointStyle: { fill: "Grey", radius: 2 },
            });

            connection3.setVisible(true);
            $("#window4").css("z-index", currentZIndex);
            instance.repaintEverything();
            disableButton("#createWindow4Btn");

            verticalOffset += 100;
            window4Opened = true;
            currentZIndex++; // Increase Z-index for next window
          } else {
            $("#window4").hide();
            if (connection3) connection3.setVisible(false);
            $("#window4").css("z-index", 5);
            instance.repaintEverything();
            enableButton("#createWindow4Btn");

            verticalOffset -= 100;
            window4Opened = false;
          }
        });

        // Toggle functionality for Window 5 (Openness)
        $("#toggle1").change(function () {
          if ($(this).prop("checked")) {
            if ($("#window5").is(":visible")) return; // Prevent opening if already visible

            var window2Position = $("#window2").offset();
            var window5Left =
              window2Position.left + $("#window2").outerWidth() + 20;
            var window5Top =
              window2Position.top + (window5Opened ? 0 : verticalOffset);
            $("#window5").css({
              left: window5Left,
              top: window5Top,
              display: "block",
            });
            enableDraggable("window5");

            connection4 = instance.connect({
              source: "window2",
              target: "window5",
              connector: ["Bezier", { curviness: 20 }],
              anchors: [
                [0.9, 0.5],
                [0.1, 0.5],
              ],
              endpoint: "Dot",
              paintStyle: { stroke: "Grey", strokeWidth: 2 },
              endpointStyle: { fill: "Grey", radius: 2 },
            });

            connection4.setVisible(true);
            $("#window5").css("z-index", currentZIndex);
            instance.repaintEverything();
            disableButton("#createWindow5Btn");

            verticalOffset += 100;
            window5Opened = true;
            currentZIndex++;
          } else {
            $("#window5").hide();
            if (connection4) connection4.setVisible(false);
            $("#window5").css("z-index", 5);
            instance.repaintEverything();
            enableButton("#createWindow5Btn");

            verticalOffset -= 100;
            window5Opened = false;
          }
        });

        // Toggle functionality for Window 6 (Items)
        $("#toggle2").change(function () {
          if ($(this).prop("checked")) {
            if ($("#window6").is(":visible")) return; // Prevent opening if already visible

            var window2Position = $("#window2").offset();
            var window6Left =
              window2Position.left + $("#window2").outerWidth() + 20;
            var window6Top =
              window2Position.top + (window6Opened ? 0 : verticalOffset);
            $("#window6").css({
              left: window6Left,
              top: window6Top,
              display: "block",
            });
            enableDraggable("window6");

            connection5 = instance.connect({
              source: "window2",
              target: "window6",
              connector: ["Bezier", { curviness: 20 }],
              anchors: [
                [0.9, 0.5],
                [0.1, 0.5],
              ],
              endpoint: "Dot",
              paintStyle: { stroke: "Grey", strokeWidth: 2 },
              endpointStyle: { fill: "Grey", radius: 2 },
            });

            connection5.setVisible(true);
            $("#window6").css("z-index", currentZIndex);
            instance.repaintEverything();
            disableButton("#createWindow6Btn");

            verticalOffset += 100;
            window6Opened = true;
            currentZIndex++;
          } else {
            $("#window6").hide();
            if (connection5) connection5.setVisible(false);
            $("#window6").css("z-index", 5);
            instance.repaintEverything();
            enableButton("#createWindow6Btn");

            verticalOffset -= 100;
            window6Opened = false;
          }
        });

        // Toggle functionality for Window 7 (New Window)
        $("#toggle7").change(function () {
          if ($(this).prop("checked")) {
            if ($("#window7").is(":visible")) return; // Prevent opening if already visible

            var window2Position = $("#window2").offset();
            var window7Left =
              window2Position.left + $("#window2").outerWidth() + 20;
            var window7Top =
              window2Position.top + (window7Opened ? 0 : verticalOffset);
            $("#window7").css({
              left: window7Left,
              top: window7Top,
              display: "block",
            });
            enableDraggable("window7");

            connection6 = instance.connect({
              source: "window2",
              target: "window7",
              connector: ["Bezier", { curviness: 20 }],
              anchors: [
                [0.9, 0.5],
                [0.1, 0.5],
              ],
              endpoint: "Dot",
              paintStyle: { stroke: "Grey", strokeWidth: 2 },
              endpointStyle: { fill: "Grey", radius: 2 },
            });

            connection6.setVisible(true);
            $("#window7").css("z-index", currentZIndex);
            instance.repaintEverything();
            disableButton("#createWindow7Btn");

            verticalOffset += 100;
            window7Opened = true;
            currentZIndex++;
          } else {
            $("#window7").hide();
            if (connection6) connection6.setVisible(false);
            $("#window7").css("z-index", 5);
            instance.repaintEverything();
            enableButton("#createWindow7Btn");

            verticalOffset -= 100;
            window7Opened = false;
          }
        });

        // Bring window to front when clicked, except window1
        $(".window").click(function () {
          if ($(this).attr("id") !== "window1") {
            bringToFront(this);
          }
        });
      });

      // Function to move the carousel images
      function moveSlide(direction, carouselId) {
        const carouselContainer = document.getElementById(carouselId);
        const carouselImages =
          carouselContainer.querySelector(".carousel-images");
        const totalImages = carouselImages.children.length;
        const currentTransform =
          carouselImages.style.transform || "translateX(0%)";
        const currentIndex =
          parseInt(
            currentTransform.replace("translateX(", "").replace("%)", "")
          ) || 0;

        let newIndex = currentIndex + direction * 100;

        // If we're at the last image, loop back to the first
        if (newIndex < -((totalImages - 1) * 100)) {
          newIndex = 0;
        }
        // If we're at the first image, loop to the last
        if (newIndex > 0) {
          newIndex = -((totalImages - 1) * 100);
        }

        carouselImages.style.transform = `translateX(${newIndex}%)`;
      }

      // Get all grid items
      const gridItems = document.querySelectorAll(".grid-item");
      const progressSlider = document.querySelector("#progressSilder"); // Select the slider element
      const gridprogressText = document.querySelector("#gridProgressText");
      //console.log(progressSlider);
      let activeCircles = 0; // Keep track of the number of active circles

      // Add click event listener to each grid item
      gridItems.forEach((item) => {
        item.addEventListener("click", function () {
          // Check if the circle is already selected or not
          const isSelected = this.classList.contains("selected");

          if (isSelected) {
            // If selected, deselect it and reduce the activeCircles count
            activeCircles--;
            this.classList.remove("selected");
          } else {
            // If not selected, check if we're already at 4 active circles
            if (activeCircles < 4) {
              activeCircles++;
              this.classList.add("selected");
            } else {
              // If 4 circles are already selected, remove one before adding the new one
              const selectedItems = document.querySelectorAll(
                ".grid-item.selected"
              );
              // Deselect the first selected circle
              selectedItems[0].classList.remove("selected");
              activeCircles--;
              activeCircles++; // Re-add the new selected circle
              this.classList.add("selected");
            }
          }
          console.log(gridprogressText);
          // Log the active circles count
          //console.log(`Active Circles: ${activeCircles}`);
          gridprogressText.innerHTML = `${activeCircles}`;

          // Update the slider width based on the number of active circles
          updateProgressSlider();
        });
      });

      // Function to update the slider width based on activeCircles
      function updateProgressSlider() {
        const percentage = (activeCircles / 4) * 94;
        progressSlider.style.width = `${percentage}%`;
      }

      const toggles = document.querySelectorAll('input[type="checkbox"]');

      toggles.forEach((toggle) => {
        toggle.addEventListener("change", function () {
          //console.log(
          // `Toggle ${toggle.id} is ${toggle.checked ? "ON" : "OFF"}`
          //);
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const svgCanvas = document.getElementById("svgCanvas");
        const innerCircle = svgCanvas.querySelector(".inner-circle");
        const centerX = 100; // The center X position of the circle
        const centerY = 100; // The center Y position of the circle
        const radius = 60; // The radius of the guideline circle (inner circle follows this)

        let isDragging = false;
        let angle = 0; // Initial angle is set to 0

        // Function to calculate the angle based on mouse position relative to the circle center
        function calculateAngle(e) {
          const rect = svgCanvas.getBoundingClientRect(); // Get the bounding box of the SVG
          const dx = e.clientX - rect.left - centerX; // Adjust mouse X relative to SVG's position
          const dy = e.clientY - rect.top - centerY; // Adjust mouse Y relative to SVG's position

          //console.log("Mouse Coordinates:", e.clientX, e.clientY);
          //console.log("Adjusted Coordinates:", dx, dy);

          return Math.atan2(dy, dx); // Returns angle in radians
        }

        // Function to set the position of the inner circle based on the angle
        function setInnerCirclePosition() {
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          //console.log("Inner Circle Position:", x, y); // Log the updated position

          innerCircle.setAttribute("cx", x);
          innerCircle.setAttribute("cy", y);
        }

        // Initialize position of the inner circle at 0 degrees
        setInnerCirclePosition();

        // Handle mouse down event to start dragging
        innerCircle.addEventListener("mousedown", (e) => {
          //console.log("Mouse Down:", e.clientX, e.clientY);
          isDragging = true;
          angle = calculateAngle(e); // Initialize the angle based on the initial mouse position
          e.preventDefault(); // Prevent text selection during drag
        });

        // Handle mouse move event to update the position of the inner circle while dragging
        window.addEventListener("mousemove", (e) => {
          if (isDragging) {
            angle = calculateAngle(e); // Update angle based on mouse movement
            setInnerCirclePosition(); // Update the inner circle's position
          }
        });

        // Handle mouse up event to stop dragging
        window.addEventListener("mouseup", () => {
          //console.log("Mouse Up");
          isDragging = false;
        });

        // Prevent dragging from continuing if the mouse leaves the SVG area
        window.addEventListener("mouseleave", () => {
          //console.log("Mouse Leave");
          isDragging = false;
        });
      });
    </script>
  </body>
</html>
